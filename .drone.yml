pipeline:

  start:
    image: docker
    secrets: [ mysql_root_password, mysql_database ]
    commands: 
      - docker run --name mysql-test -e MYSQL_ROOT_PASSWORD=${mysql_root_password} -e MYSQL_DATABASE=${mysql_database} mysql:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    when:
      branch: [master, development]
      event: push

  test:
    image: docker
    secrets: [ mysql_root_password ]
    commands:
      - docker exec mysql-test mysql -e "show databases" -u root --password=${mysql_root_password}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    when:
      branch: [master, development]
      event: push

  delete:
    image: docker
    commands:
      - sh ./scripts/rm-d.sh
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    when:
      branch: [master, development]
      event: push
